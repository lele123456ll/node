# TCP协议

> **运输层协议**

## 三次握手

- 为什么要进行?

    **目的是建立可靠的通信信道，确认双方是否都能接受与发送信息**

    - 第一次
        - `client : 什么都无法确认  server : 自己接收信息 对方发送信息`

    - 第二次
        - `client : 自己发送、接收信息， 对方发送、接收信息。 server : 自己接收信息， 对方发送信息`

    - 第三次
        - `client : 自己发送、接收信息， 对方发送、接收信息。 server ： 自己发送、接收信息， 对方发送、接收信息`

- 如何进行？
    - `客户端–发送带有 SYN 标志的数据包 => ⼀次握⼿–服务端`
    - `服务端–发送带有 SYN/ACK 标志的数据包 => ⼆次握⼿–客户端`
    - `客户端–发送带有带有 ACK 标志的数据包 => 三次握⼿–服务端`

- 图解

    <img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/501/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B1.png" alt="三次握手" style="zoom:67%;" />

## 四次挥手

- 为什么要进行？

    **任何⼀⽅都可以在数据传送结束后发出连接释放的通知，待对⽅确认后进⼊半关闭状态。当另⼀⽅也没有数据再发送的时候，则发出连接释放通知，对⽅确认后就完全关闭了TCP连接**

    - 第一次
        - `client : 主动关闭， 发送fin。 server : 接收到client关闭的信息`
    - 第二次
        - `server : 发送数据`
    - 第三次
        - `server : 发送断开信息`
    - 第四次
        - `client : 发送确认信息`

- 具体

    - `客户端-发送⼀个FIN，⽤来关闭客户端到服务器的数据传送`
    - `服务器-收到这个FIN，它发回⼀个ACK，确认序号为收到的序号加1 。和SYN⼀样，⼀个FIN占⽤⼀个序号`
    - `服务器-关闭与客户端的连接，发送⼀个FIN给客户端`
    - `客户端-发回 ACK 报⽂确认，并将确认序号设置为收到序号加1`

- 图解

    <img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/501/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png" alt="四次挥手" style="zoom:67%;" />